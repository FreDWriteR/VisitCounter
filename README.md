# Visit Counter

## Описание проекта

Visit Counter — это веб-приложение для отслеживания посещений сайта и отображения статистики. Приложение использует базу данных SQLite для хранения информации о посещениях и JWT для авторизации пользователей. Оно построено на Express и включает защищенные маршруты для доступа к статистике.

## Используемые инструменты

- **Express**: Фреймворк для создания серверных приложений на Node.js. Упрощает работу с маршрутами и middleware.
- **SQLite**: Легковесная база данных, используемая для хранения данных о посещениях.
- **bcryptjs**: Библиотека для хэширования паролей, обеспечивающая безопасное хранение паролей.
- **jsonwebtoken**: Библиотека для создания и проверки JWT (JSON Web Tokens), используемая для авторизации.
- **path**: Встроенный модуль Node.js для работы с путями файлов.
- **cookie-parser**: Middleware для обработки куков.
- **body-parser**: Middleware для обработки данных формы и JSON-запросов.

## Установка и запуск

1. Клонируйте репозиторий:

    ```bash
    git clone <URL вашего репозитория>
    cd <папка вашего проекта>
    ```

2. Установите зависимости:

    ```bash
    npm install
    ```

3. Запустите сервер:

    ```bash
    npm start
    ```

   Сервер будет доступен по адресу `http://localhost:3000`.

## Как это работает

1. **Авторизация**:
   - Пользователь заходит на страницу `/login`, вводит имя пользователя и пароль.
   - При успешной авторизации создается JWT, который сохраняется в куки с префиксом `Bearer`.
   - После авторизации пользователь перенаправляется на страницу `/stats`, где отображается статистика.

2. **Перенаправление неавторизованных пользователей**:
   - Все защищенные маршруты, такие как `/stats`, /api/stats и `/api/track`, требуют авторизации.
   - Middleware `authMiddleware` проверяет наличие и валидность JWT в куках. Если токен отсутствует или недействителен, пользователь перенаправляется на страницу логина `/login`.
   - При попытке доступа к защищенным маршрутам без авторизации пользователи будут автоматически перенаправлены на страницу логина.

3. **Статистика посещений**:
   - Статистика доступна только после авторизации и защищена middleware `authMiddleware`, который проверяет наличие и валидность JWT в куках.

4. **Отслеживание посещений**:
   - Для отслеживания посещений используется маршрут `/api/track`, защищенный авторизацией.
   - Данные о посещении (IP-адрес, город, устройство, время) сохраняются в базе данных.

5. **Запрос данных для графиков**:
   - Данные для графиков можно получить через маршрут `/api/stats`, который возвращает количество посещений по часам и городам.
